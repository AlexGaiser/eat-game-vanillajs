var mdn=window.mdn||{};var paymentsHandlerUtils={addCurrencyPrefix:function(selectedAmount){"use strict";return isNaN(selectedAmount)||selectedAmount<1?"":"$"+selectedAmount},getSelectedAmount:function(value){"use strict";return value%1===0?parseInt(value,10):parseFloat(value).toFixed(2)}};if(typeof exports==="object"){module.exports=paymentsHandlerUtils}mdn.paymentsHandlerUtils=paymentsHandlerUtils;(function(doc,win,$){"use strict";if(!win.mdn.contributions){return}var CONTRIBUTIONS_DISABLED_EXPIRATION=5*24*60*60*1e3;function checkPopoverDisabled(){if(win.mdn.features.localStorage){var disabledStorageItem=localStorage.getItem("contributionsPopoverDisabled");var date=(new Date).getTime();if(disabledStorageItem){disabledStorageItem=JSON.parse(disabledStorageItem);if(disabledStorageItem.value&&disabledStorageItem.timestamp+CONTRIBUTIONS_DISABLED_EXPIRATION<date){removeDisabledLocaleStorageItem();showPopover()}}else{showPopover()}}else{showPopover()}}function showPopover(){popoverBanner.removeClass("is-hidden");popoverBanner.attr("aria-hidden",false)}var form=$("#contribute-form");var emailField=form.find("#id_email");var nameField=form.find("#id_name");var recurringConfirmationCheckbox=form.find("#id_accept_checkbox");var customAmountInput=form.find("#id_donation_amount");var defaultAmount=customAmountInput.val()?customAmountInput:form.find("input[type='radio']:checked");var amountRadio=form.find("input[name=donation_choices]");var stripePublicKey=form.find("#id_stripe_public_key");var stripeToken=form.find("#id_stripe_token");var stripeHandler=null;var formButton=form.find("#stripe_submit");var formErrorMessage=form.find("#contribution-error-message");var amountToUpdate=form.find("[data-dynamic-amount]");var currrentPaymentForm=form.attr("data-payment-type");var requestUserLogin=doc.getElementById("login-popover");var githubRedirectButton=doc.getElementById("github_redirect_payment");var hasPaymentSwitch=Boolean(doc.getElementById("dynamic-payment-switch"));var paymentTypeSwitch=doc.querySelectorAll('input[type=radio][name="payment_selector"]');var recurringConfirmationContainer=doc.getElementById("recurring-confirmation-container");var selectedAmount=0;var submitted=false;var amountRadioInputs=doc.querySelectorAll("input[data-dynamic-choice-selector]");var paymentChoices=typeof window.payments!=="undefined"&&"paymentChoices"in window.payments?win.payments.paymentChoices:null;var triggerAnalyticEvents=!hasUserBeenRedirected();function hasUserBeenRedirected(){if(!win.mdn.features.localStorage){return false}return Boolean(localStorage.getItem("userAuthenticationOnFormSubmission"))}function initStripeHandler(){var stripeOptions={key:stripePublicKey.val(),locale:"en",name:"MDN Web Docs",description:"One-time donation",source:function(token){submitted=true;stripeToken.val(token.id);addDisabledLocaleStorageItem();sessionStorage.setItem("submissionDetails",JSON.stringify({amount:selectedAmount*100,page:isPopoverBanner?"Banner":"FAQ"}));form.submit()}};return win.StripeCheckout.configure(stripeOptions)}if(win.StripeCheckout){$("#contribution-popover-container").removeClass("is-hidden")}var isPopoverBanner=$(".contribution-banner").hasClass("contribution-popover");if(!isPopoverBanner&&win.StripeCheckout){stripeHandler=initStripeHandler()}if(isPopoverBanner){var activeElement=null;var popoverBanner=$(".contribution-banner");var collapseButton=popoverBanner.find("#collapse-popover-button");var closeButton=popoverBanner.find("#close-popover-button");checkPopoverDisabled()}if(defaultAmount.get(0)){onAmountSelect({target:defaultAmount.get(0)},true)}form.find(".errorlist").prev().addClass("error");function triggerRecurringPaymentEvent(event,storeUserForLaterEvents){if(!triggerAnalyticEvents||!win.mdn.features.localStorage){return}mdn.analytics.trackEvent({category:"Recurring payments",action:event.action,label:win.payments.isAuthenticated?"authenticated":"anonymous",value:event.value});mdn.analytics.trackEvent({category:"Recurring payments v2",action:event.action+" - "+win.payments.isAuthenticated?"authenticated":"anonymous",label:win.payments.isAuthenticated?"authenticated":"anonymous",value:event.value});if(storeUserForLaterEvents){var item=win.payments.isAuthenticated?"authenticated":"anonymous";localStorage.setItem("userAuthenticationOnFormSubmission",item);triggerAnalyticEvents=false}}function triggerOneTimePaymentEvent(event){if(!triggerAnalyticEvents){return}mdn.analytics.trackEvent({category:"payments",action:event.action,label:event.label,value:event.value})}function onAmountSelect(event,automatedSelection){form.find("label.active").removeClass("active");clearFieldError(customAmountInput);if(!automatedSelection&&(parseInt(event.target.value)<1||isNaN(event.target.value))){defaultAmount.prop("checked",true);setFieldError(customAmountInput)}if(event.target.type==="radio"){customAmountInput.val("");if(!automatedSelection){triggerOneTimePaymentEvent({action:"banner",label:"Amount radio selected",value:(selectedAmount*100).toFixed(0)})}$(event.target).parent().addClass("active")}else{form.find("input[type='radio']:checked").prop("checked",false)}selectedAmount=mdn.paymentsHandlerUtils.getSelectedAmount(event.target.value);var newValue=mdn.paymentsHandlerUtils.addCurrencyPrefix(selectedAmount);amountToUpdate.html(newValue);newValue+=currrentPaymentForm==="recurring"&&newValue!==""&&isPopoverBanner?"/month":"";amountToUpdate[2].textContent=newValue}function setFieldError(field){$(field).addClass("error");$(field).next(".errorlist").remove();var error=$(field).attr("data-error-message");$('<ul class="errorlist"><li>'+error+"</li></ul>").insertAfter($(field))}function clearFieldError(field){$(field).removeClass("error");$(field).next(".errorlist").remove()}function onChange(event){var field=$(event.target)[0];field.value=field.value.trim();if(field.checkValidity()){clearFieldError(field)}else{setFieldError(field)}}function onSubmit(){var valid=form[0].checkValidity();if(!valid||(selectedAmount<1||isNaN(selectedAmount))){if(emailField[0].checkValidity()){clearFieldError(emailField[0])}else{setFieldError(emailField[0])}if(nameField[0].checkValidity()){clearFieldError(nameField[0])}else{setFieldError(nameField[0])}if(selectedAmount>=1){clearFieldError(customAmountInput)}else{setFieldError(customAmountInput)}if(recurringConfirmationCheckbox[0].checkValidity()){clearFieldError(recurringConfirmationCheckbox[0])}else if(currrentPaymentForm==="recurring"){setFieldError(recurringConfirmationCheckbox[0])}return}currrentPaymentForm==="recurring"?triggerRecurringPaymentEvent({action:"Form completed",value:(selectedAmount*100).toFixed(0)},true):triggerOneTimePaymentEvent({action:"submission",label:isPopoverBanner?"On pop over":"On FAQ page",value:(selectedAmount*100).toFixed(0)});if(requestUserLogin&&currrentPaymentForm==="recurring"){requestUserLogin.classList.remove("hidden");form.get(0).classList.add("hidden");return}if(stripeHandler!==null){stripeHandler.open({image:"https://avatars1.githubusercontent.com/u/7565578?s=280&v=4",name:"MDN Web Docs",description:"Contribute to MDN Web Docs",zipCode:true,allowRememberMe:false,panelLabel:currrentPaymentForm==="recurring"?"Pay {{amount}}/month":"Pay",amount:parseInt((selectedAmount*100).toFixed(0)),email:$(emailField).val(),closed:function(){if(!submitted){triggerOneTimePaymentEvent({action:"submission",label:"canceled"})}form.removeClass("disabled")}})}}function onFormButtonClick(){if(isPopoverBanner&&popoverBanner.hasClass("is-collapsed")){expandPopover()}else{onSubmit()}}var mediaQueryList=null;function handleViewportChange(evt){if(evt.matches){popoverBanner.removeClass("expanded");popoverBanner.addClass("expanded-extend")}else{popoverBanner.removeClass("expanded-extend");popoverBanner.addClass("expanded")}}function getStripeCheckoutScript(){if(stripeHandler){return}$.ajax({url:"https://checkout.stripe.com/checkout.js",dataType:"script",cache:true}).done(function(){stripeHandler=initStripeHandler()}).fail(function(error){console.error("Failed to load stripe checkout library",error);toggleScriptError()})}function toggleScriptError(){formButton.attr("disabled")?formButton.removeAttr("disabled"):formButton.attr("disabled","true");formErrorMessage.toggle()}function expandPopover(){getStripeCheckoutScript();var secondaryHeader=popoverBanner[0].querySelector("h4");var smallDesktop="(max-width: 1092px)";mediaQueryList=window.matchMedia(smallDesktop);var initialExpandedClass=mediaQueryList.matches||currrentPaymentForm==="recurring"?"expanded-extend":"expanded";popoverBanner.addClass(initialExpandedClass+" is-expanding");popoverBanner.removeClass("is-collapsed");mediaQueryList.addListener(handleViewportChange);popoverBanner.on("transitionend",function(){popoverBanner.removeClass("is-expanding");popoverBanner.attr("aria-expanded",true);activeElement=document.activeElement;secondaryHeader.focus();popoverBanner.off("transitionend");collapseButton.click(collapseCta);$(doc).on("keydown.popoverCloseHandler",function(event){if(event.keyCode===27){collapseCta()}})});currrentPaymentForm==="recurring"?triggerRecurringPaymentEvent({action:"banner expanded"}):triggerOneTimePaymentEvent({action:"banner",label:"expand"})}function collapseCta(){collapseButton.off();if(formButton.hasClass("disabled")){toggleScriptError()}popoverBanner.addClass("is-collapsing");popoverBanner.removeClass("expanded expanded-extend");popoverBanner.attr("aria-expanded",false);mediaQueryList.removeListener(handleViewportChange);popoverBanner.on("transitionend",function(){popoverBanner.addClass("is-collapsed");popoverBanner.removeClass("is-collapsing");popoverBanner.off("transitionend");activeElement.focus()});triggerOneTimePaymentEvent({action:"banner",label:"collapse"});$(doc).off("keydown.popoverCloseHandler")}function disablePopover(){popoverBanner.addClass("is-hidden");popoverBanner.attr("aria-hidden",true);triggerOneTimePaymentEvent({action:"banner",label:"close"});addDisabledLocaleStorageItem()}function addDisabledLocaleStorageItem(){if(win.mdn.features.localStorage){var item=JSON.stringify({value:true,timestamp:(new Date).getTime()});localStorage.setItem("contributionsPopoverDisabled",item)}}function removeDisabledLocaleStorageItem(){if(win.mdn.features.localStorage){localStorage.removeItem("contributionsPopoverDisabled")}}function redirectUserToLogin(event){event.preventDefault();var gitHubLink=$(this).attr("href");var gitHubNext=$(this).data("next");var getFormFields=form.serialize();gitHubLink+="&next="+gitHubNext+"?"+encodeURIComponent(getFormFields);window.location.href=encodeURI(gitHubLink)}if(requestUserLogin){$(githubRedirectButton).on("click",redirectUserToLogin)}formButton.click(onFormButtonClick);amountRadio.change(onAmountSelect);customAmountInput.on("input",onAmountSelect);emailField.blur(onChange);nameField.blur(onChange);customAmountInput.blur(function(event){var value=parseFloat(event.target.value);if(!isNaN(value)&&value>=1){this.value=selectedAmount;triggerOneTimePaymentEvent({action:"banner",label:"custom amount",value:(value*100).toFixed(0)})}else{triggerOneTimePaymentEvent({action:"banner",label:"Invalid amount selected"})}});if(currrentPaymentForm==="recurring"){recurringConfirmationCheckbox.change(function(){clearFieldError(recurringConfirmationCheckbox[0])})}if(isPopoverBanner){closeButton.click(disablePopover)}function switchPaymentTypeHandler(){var action=form.get(0).getAttribute("action");var checkedInput=null;customAmountInput.get(0).value="";selectedAmount=0;if(this.value==="one_time"&&currrentPaymentForm==="recurring"){currrentPaymentForm="one_time";if(requestUserLogin){requestUserLogin.classList.add("hidden");form.get(0).classList.remove("hidden")}recurringConfirmationCheckbox.get(0).removeAttribute("required");recurringConfirmationContainer.classList.add("hidden");action=form.get(0).getAttribute("data-one-time-action");[].forEach.call(amountRadioInputs,function(radio,i){radio.setAttribute("value",paymentChoices.oneTime[i]);radio.nextSibling.nodeValue="$"+paymentChoices.oneTime[i]});form.get(0).classList.remove("recurring-form");popoverBanner.get(0).classList.add("expanded");popoverBanner.get(0).classList.remove("expanded-extend")}else if(this.value==="recurring"&&currrentPaymentForm==="one_time"){currrentPaymentForm="recurring";recurringConfirmationContainer.classList.remove("hidden");recurringConfirmationCheckbox.get(0).setAttribute("required","");action=form.get(0).getAttribute("data-recurring-action");[].forEach.call(amountRadioInputs,function(radio,i){radio.setAttribute("value",paymentChoices.recurring[i]);radio.nextSibling.nodeValue="$"+paymentChoices.recurring[i]+"/mo"});form.get(0).classList.add("recurring-form");popoverBanner.get(0).classList.add("expanded-extend")}form.get(0).setAttribute("action",action);checkedInput=form.find("input[type='radio']:checked")[0];if(checkedInput){onAmountSelect({target:{value:NaN}},true)}else if(customAmountInput.get(0).value){onAmountSelect({target:customAmountInput.get(0)})}}if(hasPaymentSwitch&&isPopoverBanner){[].forEach.call(paymentTypeSwitch,function(radio){radio.addEventListener("change",switchPaymentTypeHandler)});if(currrentPaymentForm==="recurring"){[].forEach.call(amountRadioInputs,function(radio,i){radio.setAttribute("value",paymentChoices.recurring[i]);radio.nextSibling.nodeValue="$"+paymentChoices.recurring[i]+"/mo"});recurringConfirmationCheckbox.get(0).setAttribute("required","");var checkedInput=form.find("input[type='radio']:checked")[0];if(checkedInput){onAmountSelect({target:checkedInput},true)}}}if(popoverBanner&&popoverBanner.is(":visible")){currrentPaymentForm==="recurring"?triggerRecurringPaymentEvent({action:"banner shown"}):triggerOneTimePaymentEvent({action:"banner",label:"shown"})}else if(!popoverBanner&&currrentPaymentForm==="recurring"){triggerRecurringPaymentEvent({action:"banner shown on FAQ"})}})(document,window,jQuery);(function($){"use strict";var faqContainer=$("#contributions-page");var thumbsUp=faqContainer.find(".thumbs-up");var thumbsDown=faqContainer.find(".thumbs-down");var faqFeedback=faqContainer.find("#faq-feedback");var faqFeedbackConfirmation=faqContainer.find(".feedback-confirmation");function sendAnalyticsVoteEvent(action,label,value){var event={category:"payments",action:action,value:value};if(label){event.label=label}mdn.analytics.trackEvent(event)}function onThumbsUp(event){var questionNumber=$(event.target).attr("data-faq")||0;$(event.target).next().removeClass("active");$(event.target).addClass("active");sendAnalyticsVoteEvent("FAQ vote","question_"+questionNumber,1)}function onThumbsDown(event){var questionNumber=$(event.target).attr("data-faq")||0;$(event.target).prev().removeClass("active");$(event.target).addClass("active");sendAnalyticsVoteEvent("FAQ vote","question_"+questionNumber,0)}function onFeedback(event){event.preventDefault();var feedback=document.getElementById("contribution-feedback").value;if(feedback&&feedback.trim!==""){mdn.analytics.trackEvent({category:"payments",action:"FAQ - Any other questions",label:feedback},function(){faqFeedbackConfirmation.get(0).classList.remove("hidden");faqFeedbackConfirmation.get(0).removeAttribute("aria-hidden");faqFeedback.get(0).classList.add("disabled")})}else{faqFeedback.get(0).classList.remove("disabled")}}thumbsUp.click(onThumbsUp);thumbsDown.click(onThumbsDown);faqFeedback.submit(onFeedback)})(jQuery);(function(doc,win,$){"use strict";function setupTooltips(){var buttons=$(".tooltip-button");if(!buttons.length){return}function openTooltip(tooltip){$(tooltip).appendTo("body");$(tooltip).addClass("is-open").attr("aria-hidden",false);$(doc).on("click.tooltipHandler",function(event){if(!$(tooltip).get(0).contains(event.target)||$(event.target).hasClass("tooltip-close")){event.preventDefault();closeTooltip(tooltip)}});$(win).on("resize.tooltipHandler",function(){closeTooltip(tooltip)});mdn.analytics.trackEvent({category:"payments",action:"banner",label:"Tooltip Opened"})}function closeTooltip(tooltip){$(tooltip).removeClass("is-open has-arrow-top").attr("aria-hidden",true).css({left:0,top:0});$(doc).off("click.tooltipHandler");$(win).off("resize.tooltipHandler");mdn.analytics.trackEvent({category:"payments",action:"banner",label:"Tooltip Closed"})}function positionTooltip(tooltip,element){tooltip.classList.add("is-opening");var tooltipDomRect=$(tooltip).get(0).getBoundingClientRect();var elementDomRect=element.get(0).getBoundingClientRect();var position;if(tooltipDomRect.width>elementDomRect.left){position={left:elementDomRect.left+elementDomRect.width-tooltipDomRect.width+4,top:elementDomRect.top+elementDomRect.height+win.scrollY+10};tooltip.classList.add("has-arrow-top")}else{position={left:elementDomRect.left-elementDomRect.width/2-(tooltipDomRect.width-10),top:elementDomRect.top+elementDomRect.height/2-tooltipDomRect.height/2+win.scrollY}}$(tooltip).css(position);tooltip.classList.remove("is-opening")}buttons.on("click",function(event){event.stopImmediatePropagation();event.preventDefault();var target=$(event.target).closest("[aria-controls]");if(!target.length){return}var tooltipId=target.get(0).getAttribute("aria-controls");var tooltip=doc.getElementById(tooltipId);if(!tooltip){return}if(tooltip.classList.contains("is-open")){closeTooltip(tooltip)}else{positionTooltip(tooltip,target);openTooltip(tooltip)}})}setupTooltips()})(document,window,jQuery);(function(win,doc){"use strict";var path=win.location.pathname;if(!path.includes("/payments/recurring/management")){return}var toggleConfirmationButtons=Array.from(doc.querySelectorAll("button[toggle-confirmation]"));var confirmationDialog=doc.getElementById("delete-confirmation");function toggleDeleteConfirmaiton(){toggleConfirmationButtons[0].classList.toggle("hidden");confirmationDialog.classList.toggle("hidden");confirmationDialog.toggleAttribute("aria-hidden")}toggleConfirmationButtons.forEach(function(button){button.addEventListener("click",toggleDeleteConfirmaiton)})})(window,document);
